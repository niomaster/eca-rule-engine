IMPORT standaard
IMPORT imports
IMPORT twitpic

CONSTANT re = module("re")
DECLARE ptrn = re.compile('https?:\/\/t.co\/[^\s<>"]+', re.I) #regex voor t.co linkjes

CELL 'tweetlistcell_urls' {'event': 'createTweetlistGadget', 'data': [json_serialize({"cell": "tweetlistcell_urls", "id": "myUrlTweetlist", "title": "tweets"})]}

DECLARE bata_gerelateerd = csv_read_kv_dict('modules/bata_gerelateerd.csv',1,0)

RULE: the_finalization_rule
EVENT: finalize
CONDITION: True
ACTION:	print("done")
	bata_gerelateerd = None
	ptrn = None

RULE: new_tweet_rule
EVENT: new_tweet
CONDITION: bata_gerelateerd[new_tweet.id] == "Y"
ACTION:	NEWEVENT new_bata_gerelateerd_tweet {tweet : new_tweet}

RULE: new_bata_gerelateerd_tweet_rule
EVENT: new_bata_gerelateerd_tweet
CONDITION: len(ptrn.findall(new_bata_gerelateerd_tweet.tweet.text)) > 0
ACTION:	add_tweetlist_tweet('myUrlTweetlist', new_bata_gerelateerd_tweet.tweet.json_dict)
	FORALL u IN ptrn.findall(new_bata_gerelateerd_tweet.tweet.text): NEWEVENT new_url {url : u}

RULE: new_url_rule
EVENT: new_url
CONDITION: True
ACTION: print(new_url.url)

RULE: new_url_rule
EVENT: new_url
CONDITION: twitpic.getid(new_url.url) != ''
ACTION: print(twitpic.getfull(new_url.url)) #laat plaatje op de site zien